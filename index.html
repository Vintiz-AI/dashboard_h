<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Inteligente Hospitalario | Dashboard Completo</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        /* Todos los estilos CSS del documento original aqu√≠ */
        :root {
            --primary-blue: #0066CC;
            --primary-blue-dark: #004C99;
            --primary-blue-light: #3385D6;
            --success-green: #00A86B;
            --warning-yellow: #FFB020;
            --danger-red: #E63946;
            --critical-red: #DC143C;
            --bg-primary: #F8FAFB;
            --bg-secondary: #FFFFFF;
            --bg-tertiary: #E8EEF2;
            --bg-dark: #1A2332;
            --text-primary: #1A2332;
            --text-secondary: #5A6C7D;
            --text-tertiary: #8B9BAA;
            --text-white: #FFFFFF;
            --border-color: #DDE4EB;
            --border-hover: #B8C5D1;
            --shadow-sm: 0 1px 3px rgba(26, 35, 50, 0.08);
            --shadow-md: 0 4px 12px rgba(26, 35, 50, 0.1);
            --shadow-lg: 0 10px 30px rgba(26, 35, 50, 0.15);
            --shadow-xl: 0 20px 50px rgba(26, 35, 50, 0.2);
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --transition-fast: 150ms ease;
            --transition-normal: 250ms ease;
            --transition-slow: 400ms ease;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }
        
        .dashboard-container { display: flex; height: 100vh; overflow: hidden; }
        
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, var(--bg-dark) 0%, #0F1721 100%);
            color: var(--text-white);
            padding: 24px 0;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-xl);
            z-index: 100;
        }
        
        .sidebar-header { padding: 0 24px 24px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        
        .hospital-logo { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
        
        .logo-icon {
            width: 48px; height: 48px;
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-light) 100%);
            border-radius: var(--radius-md);
            display: flex; align-items: center; justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 12px rgba(0, 102, 204, 0.3);
        }
        
        .hospital-name { font-size: 18px; font-weight: 700; }
        .hospital-subtitle { font-size: 12px; color: rgba(255, 255, 255, 0.6); }
        
        .user-info {
            display: flex; align-items: center; gap: 12px;
            padding: 16px 24px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-md);
            margin: 0 16px 16px;
        }
        
        .user-avatar {
            width: 40px; height: 40px; border-radius: 50%;
            background: linear-gradient(135deg, var(--success-green) 0%, #00D98B 100%);
            display: flex; align-items: center; justify-content: center;
            font-weight: 600; font-size: 16px;
        }
        
        .user-name { font-size: 14px; font-weight: 600; }
        .user-role { font-size: 12px; color: rgba(255, 255, 255, 0.6); }
        
        .nav-menu { flex: 1; overflow-y: auto; padding: 8px 16px; }
        .nav-section { margin-bottom: 24px; }
        .nav-section-title {
            font-size: 11px; font-weight: 600; text-transform: uppercase;
            letter-spacing: 0.8px; color: rgba(255, 255, 255, 0.4);
            padding: 8px 12px; margin-bottom: 4px;
        }
        
        .nav-item {
            display: flex; align-items: center; gap: 12px;
            padding: 12px 16px; border-radius: var(--radius-md);
            color: rgba(255, 255, 255, 0.8); cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .nav-item:hover { background: rgba(255, 255, 255, 0.08); color: var(--text-white); }
        .nav-item.active {
            background: linear-gradient(90deg, rgba(0, 102, 204, 0.15) 0%, rgba(51, 133, 214, 0.05) 100%);
            color: var(--text-white); font-weight: 500;
        }
        
        .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        
        .top-header {
            background: var(--bg-secondary); padding: 16px 32px;
            display: flex; align-items: center; justify-content: space-between;
            box-shadow: var(--shadow-sm);
            border-bottom: 1px solid var(--border-color);
        }
        
        .page-title { font-size: 24px; font-weight: 700; color: var(--text-primary); }
        
        .content-area { flex: 1; overflow-y: auto; padding: 24px 32px; }
        
        .content-grid { display: none; }
        .content-grid.active { display: block; animation: fadeIn 0.3s ease; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px; margin-bottom: 24px;
        }
        
        .kpi-card {
            background: var(--bg-secondary); border-radius: var(--radius-lg);
            padding: 24px; box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: all var(--transition-normal); cursor: pointer;
        }
        
        .kpi-card:hover { transform: translateY(-4px); box-shadow: var(--shadow-lg); }
        
        .kpi-value {
            font-size: 36px; font-weight: 700; color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
        }
        
        .content-section {
            background: var(--bg-secondary); border-radius: var(--radius-lg);
            padding: 24px; margin-bottom: 24px;
            box-shadow: var(--shadow-sm); border: 1px solid var(--border-color);
        }
        
        .section-title { font-size: 18px; font-weight: 700; }
        
        .data-table {
            width: 100%; border-collapse: separate; border-spacing: 0;
        }
        
        .data-table th {
            padding: 12px 16px; text-align: left; font-size: 12px;
            font-weight: 600; color: var(--text-secondary);
            text-transform: uppercase; background: var(--bg-tertiary);
            border-bottom: 2px solid var(--border-color);
        }
        
        .data-table td {
            padding: 16px; border-bottom: 1px solid var(--border-color);
            font-size: 14px;
        }
        
        .data-table tr:hover { background: var(--bg-primary); }
        
        .status-badge {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 4px 12px; border-radius: 20px;
            font-size: 12px; font-weight: 600;
        }
        
        .status-badge.success { background: rgba(0, 168, 107, 0.1); color: var(--success-green); }
        .status-badge.warning { background: rgba(255, 176, 32, 0.1); color: var(--warning-yellow); }
        .status-badge.danger { background: rgba(230, 57, 70, 0.1); color: var(--danger-red); }
        
        .alert {
            padding: 16px 20px; border-radius: var(--radius-md);
            display: flex; align-items: flex-start; gap: 12px;
            margin-bottom: 12px; border-left: 4px solid;
        }
        
        .alert.critical { background: rgba(220, 20, 60, 0.08); border-color: var(--critical-red); color: var(--critical-red); }
        .alert.warning { background: rgba(255, 176, 32, 0.08); border-color: var(--warning-yellow); }
        
        .chat-widget {
            position: fixed; bottom: 24px; right: 24px;
            width: 420px; height: 620px;
            background: var(--bg-secondary);
            border-radius: 20px;
            box-shadow: 0 12px 48px rgba(0, 40, 100, 0.18), 0 0 0 1px rgba(0, 60, 140, 0.08);
            display: flex; flex-direction: column;
            z-index: 1000;
            transform: translateY(calc(100% + 24px));
            transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }
        
        .chat-widget.open { transform: translateY(0); }
        
        .chat-toggle-btn {
            position: fixed; bottom: 24px; right: 24px;
            width: 62px; height: 62px;
            background: linear-gradient(135deg, #0077E6 0%, #0055AA 50%, #003D80 100%);
            color: white; border: none; border-radius: 50%;
            cursor: pointer; font-size: 26px;
            box-shadow: 0 6px 24px rgba(0, 80, 180, 0.4), 0 0 0 4px rgba(0, 100, 210, 0.12);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 999;
            animation: togglePulse 3s ease-in-out infinite;
        }
        @keyframes togglePulse {
            0%, 100% { box-shadow: 0 6px 24px rgba(0, 80, 180, 0.4), 0 0 0 4px rgba(0, 100, 210, 0.12); }
            50% { box-shadow: 0 6px 28px rgba(0, 80, 180, 0.5), 0 0 0 8px rgba(0, 100, 210, 0.08); }
        }
        
        .chat-toggle-btn:hover { transform: scale(1.1); box-shadow: 0 8px 32px rgba(0, 80, 180, 0.5), 0 0 0 4px rgba(0, 100, 210, 0.15); }
        .chat-toggle-btn.hidden { display: none; }

        /* === Chat Header === */
        .chat-header-bar {
            background: linear-gradient(135deg, #0066CC 0%, #004AAD 40%, #003380 100%);
            color: white; padding: 18px 20px; flex-shrink: 0;
            position: relative; overflow: hidden;
        }
        .chat-header-bar::before {
            content: ''; position: absolute; top: -50%; right: -20%;
            width: 200px; height: 200px; border-radius: 50%;
            background: rgba(255,255,255,0.05);
        }
        .chat-header-bar::after {
            content: ''; position: absolute; bottom: -60%; left: -10%;
            width: 160px; height: 160px; border-radius: 50%;
            background: rgba(255,255,255,0.04);
        }
        .chat-header-inner {
            display: flex; justify-content: space-between; align-items: center;
            position: relative; z-index: 1;
        }
        .chat-header-left { display: flex; align-items: center; gap: 12px; }
        .chat-header-icon {
            width: 40px; height: 40px; border-radius: 12px;
            background: rgba(255,255,255,0.15); backdrop-filter: blur(8px);
            display: flex; align-items: center; justify-content: center;
            font-size: 20px;
        }
        .chat-header-title { font-size: 15px; font-weight: 700; letter-spacing: -0.2px; }
        .chat-header-status {
            font-size: 11.5px; opacity: 0.85; display: flex; align-items: center; gap: 5px; margin-top: 1px;
        }
        .chat-status-dot {
            width: 7px; height: 7px; border-radius: 50%;
            background: #4ADE80;
            box-shadow: 0 0 6px rgba(74, 222, 128, 0.6);
            animation: statusBlink 2s ease-in-out infinite;
        }
        @keyframes statusBlink {
            0%, 100% { opacity: 1; } 50% { opacity: 0.5; }
        }
        .chat-close-btn {
            background: rgba(255,255,255,0.12); border: none;
            width: 30px; height: 30px; border-radius: 8px;
            color: white; cursor: pointer; font-size: 14px;
            display: flex; align-items: center; justify-content: center;
            transition: background 0.2s ease;
        }
        .chat-close-btn:hover { background: rgba(255,255,255,0.25); }

        /* === Messages area === */
        .chat-messages-area {
            flex: 1; padding: 16px; overflow-y: auto;
            background: linear-gradient(180deg, #F0F4F8 0%, #F8FAFB 100%);
            display: flex; flex-direction: column; gap: 10px;
        }
        .chat-messages-area::-webkit-scrollbar { width: 4px; }
        .chat-messages-area::-webkit-scrollbar-track { background: transparent; }
        .chat-messages-area::-webkit-scrollbar-thumb { background: #C8D3DE; border-radius: 4px; }

        .chat-bubble {
            max-width: 85%; padding: 11px 15px;
            font-size: 13.5px; line-height: 1.55;
            word-wrap: break-word;
            animation: chatFadeIn 0.35s cubic-bezier(0.4, 0, 0.2, 1);
        }
        @keyframes chatFadeIn {
            from { opacity: 0; transform: translateY(8px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        .chat-bubble.bot {
            align-self: flex-start;
            background: white;
            border: 1px solid #E2E8F0;
            border-left: 3px solid #0066CC;
            border-radius: 4px 14px 14px 14px;
            color: var(--text-primary);
            box-shadow: 0 1px 4px rgba(0, 40, 100, 0.06);
        }
        .chat-bubble.bot strong { color: #0059B3; }
        .chat-bubble.user {
            align-self: flex-end;
            background: linear-gradient(135deg, #0071E3 0%, #0055B8 100%);
            color: white;
            border-radius: 14px 4px 14px 14px;
            box-shadow: 0 2px 8px rgba(0, 80, 180, 0.25);
        }

        .chat-typing-indicator {
            align-self: flex-start;
            padding: 12px 18px;
            background: white;
            border: 1px solid #E2E8F0;
            border-left: 3px solid #0066CC;
            border-radius: 4px 14px 14px 14px;
            display: none; gap: 5px; align-items: center;
            box-shadow: 0 1px 4px rgba(0, 40, 100, 0.06);
        }
        .chat-typing-indicator.visible { display: flex; }
        .chat-typing-indicator span {
            width: 7px; height: 7px; border-radius: 50%;
            background: #0066CC;
            animation: typingDot 1.4s infinite;
        }
        .chat-typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .chat-typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typingDot {
            0%, 60%, 100% { opacity: 0.2; transform: scale(0.7); }
            30% { opacity: 1; transform: scale(1); }
        }

        /* === Input area === */
        .chat-input-row {
            padding: 14px 16px 16px; background: white;
            border-top: 1px solid #E8EEF3;
            display: flex; gap: 10px; align-items: center;
        }
        .chat-input-row input {
            flex: 1; padding: 11px 16px;
            border: 2px solid #E2E8F0;
            border-radius: 22px; font-family: inherit;
            font-size: 13.5px; outline: none;
            background: #F7F9FC;
            transition: all 0.2s ease;
        }
        .chat-input-row input:focus { border-color: #0066CC; background: white; box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1); }
        .chat-input-row input::placeholder { color: #A0AEC0; }
        .chat-send {
            width: 40px; height: 40px; border: none; border-radius: 12px;
            background: linear-gradient(135deg, #0071E3 0%, #0055B8 100%);
            color: white; cursor: pointer; font-size: 16px;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(0, 80, 180, 0.25);
        }
        .chat-send:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0, 80, 180, 0.35); }
        .chat-send:active { transform: translateY(0); }
        .chat-send:disabled { opacity: 0.35; cursor: not-allowed; transform: none; box-shadow: none; }

        /* === Suggestions === */
        .chat-suggestions {
            display: flex; flex-wrap: wrap; gap: 6px;
            padding: 8px 16px 4px;
            background: linear-gradient(180deg, #F0F4F8, #F8FAFB);
        }
        .chat-suggestion {
            padding: 7px 14px; background: white;
            border: 1px solid #DBE4EE; border-radius: 18px;
            font-size: 11.5px; color: #0066CC; font-weight: 500;
            cursor: pointer; font-family: inherit;
            transition: all 0.2s ease;
            box-shadow: 0 1px 2px rgba(0, 40, 100, 0.05);
        }
        .chat-suggestion:hover {
            background: linear-gradient(135deg, #0071E3, #0055B8);
            color: white; border-color: transparent;
            box-shadow: 0 2px 8px rgba(0, 80, 180, 0.25);
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="hospital-logo">
                    <div class="logo-icon">‚öïÔ∏è</div>
                    <div>
                        <div class="hospital-name">Hospital San Rafael</div>
                        <div class="hospital-subtitle">Sistema Inteligente</div>
                    </div>
                </div>
            </div>
            
            <div class="user-info">
                <div class="user-avatar">DG</div>
                <div>
                    <div class="user-name">Director General</div>
                    <div class="user-role">Acceso completo</div>
                </div>
            </div>
            
            <nav class="nav-menu">
                <div class="nav-section">
                    <div class="nav-section-title">Principal</div>
                    <div class="nav-item active" data-module="ejecutivo">
                        <span>üìä</span> Vista Ejecutiva
                    </div>
                    <div class="nav-item" data-module="calidad">
                        <span>üèÜ</span> Calidad y Anal√≠tica
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Operaciones</div>
                    <div class="nav-item" data-module="urgencias">
                        <span>üö®</span> Urgencias
                    </div>
                    <div class="nav-item" data-module="hospitalizacion">
                        <span>üè•</span> Hospitalizaci√≥n
                    </div>
                    <div class="nav-item" data-module="consulta">
                        <span>üìÖ</span> Consulta Externa
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">An√°lisis</div>
                    <div class="nav-item" data-module="epidemiologia">
                        <span>ü¶†</span> Epidemiolog√≠a
                    </div>
                    <div class="nav-item" data-module="financiero">
                        <span>üí∞</span> Financiero
                    </div>
                </div>
            </nav>
        </aside>
        
        <main class="main-content">
            <header class="top-header">
                <h1 class="page-title" id="pageTitle">Vista Ejecutiva</h1>
                <div id="currentTime" style="font-family: 'JetBrains Mono', monospace; font-size: 16px; font-weight: 600;">14:35:42</div>
            </header>
            
            <div class="content-area">
                <!-- M√ìDULO EJECUTIVO -->
                <div class="content-grid active" id="module-ejecutivo">
                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 16px;">PACIENTES HOY</div>
                            <div class="kpi-value">847</div>
                            <div style="font-size: 14px; color: var(--text-secondary);">Total atenciones</div>
                        </div>
                        <div class="kpi-card">
                            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 16px;">URGENCIAS</div>
                            <div class="kpi-value">124</div>
                            <div style="font-size: 14px; color: var(--text-secondary);">18 en atenci√≥n</div>
                        </div>
                        <div class="kpi-card">
                            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 16px;">OCUPACI√ìN</div>
                            <div class="kpi-value">78%</div>
                            <div style="font-size: 14px; color: var(--text-secondary);">87/112 camas</div>
                        </div>
                        <div class="kpi-card">
                            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 16px;">SATISFACCI√ìN</div>
                            <div class="kpi-value">4.6/5</div>
                            <div style="font-size: 14px; color: var(--text-secondary);">234 encuestas</div>
                        </div>
                    </div>
                    
                    <div class="alert critical">
                        <div style="font-size: 20px;">üî¥</div>
                        <div>
                            <div style="font-weight: 600; margin-bottom: 4px;">ALERTA CR√çTICA</div>
                            <div>UCI: Ocupaci√≥n 92% - Solo 3 camas libres</div>
                        </div>
                    </div>
                    
                    <div class="content-section">
                        <div class="section-title" style="margin-bottom: 20px;">üìà Producci√≥n Mensual - Enero 2026</div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Tipo de Atenci√≥n</th>
                                    <th>Cantidad</th>
                                    <th>Porcentaje</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Consulta Externa</td>
                                    <td>17,396</td>
                                    <td>74.1%</td>
                                    <td><span class="status-badge success">‚úì</span></td>
                                </tr>
                                <tr>
                                    <td>Urgencias</td>
                                    <td>3,720</td>
                                    <td>15.9%</td>
                                    <td><span class="status-badge warning">‚ö†Ô∏è</span></td>
                                </tr>
                                <tr>
                                    <td>Hospitalizaci√≥n</td>
                                    <td>2,340</td>
                                    <td>10.0%</td>
                                    <td><span class="status-badge success">‚úì</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- OTROS M√ìDULOS (contenido similar estructura) -->
                <div class="content-grid" id="module-calidad">
                    <div class="content-section">
                        <div class="section-title" style="margin-bottom: 20px;">üèÜ Indicadores de Calidad</div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Indicador</th>
                                    <th>Actual</th>
                                    <th>Meta</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Infecci√≥n intrahospitalaria</td>
                                    <td>1.2%</td>
                                    <td>&lt;2%</td>
                                    <td><span class="status-badge success">‚úì Cumple</span></td>
                                </tr>
                                <tr>
                                    <td>Reingresos 30 d√≠as</td>
                                    <td>4.8%</td>
                                    <td>&lt;5%</td>
                                    <td><span class="status-badge success">‚úì Cumple</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="content-grid" id="module-urgencias">
                    <div class="alert warning">
                        <div style="font-size: 20px;">üö®</div>
                        <div>
                            <div style="font-weight: 600;">MONITOREO EN TIEMPO REAL</div>
                            <div>18 pacientes en atenci√≥n | 7 en espera</div>
                        </div>
                    </div>
                </div>
                
                <div class="content-grid" id="module-hospitalizacion">
                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 16px;">TOTAL CAMAS</div>
                            <div class="kpi-value">112</div>
                        </div>
                        <div class="kpi-card">
                            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 16px;">OCUPADAS</div>
                            <div class="kpi-value">87</div>
                        </div>
                    </div>
                </div>
                
                <div class="content-grid" id="module-consulta">
                    <div class="content-section">
                        <div class="section-title">üìÖ Consulta Externa</div>
                        <p>Citas programadas: 247 | Atendidas: 156 | Ausentismo: 8.5%</p>
                    </div>
                </div>
                
                <div class="content-grid" id="module-epidemiologia">
                    <div class="alert critical">
                        <div style="font-size: 20px;">üî¥</div>
                        <div>
                            <div style="font-weight: 600;">ALERTA EPIDEMIOL√ìGICA</div>
                            <div>IRA: 47 casos en 72h (‚Üë35% vs promedio)</div>
                        </div>
                    </div>
                </div>
                
                <div class="content-grid" id="module-financiero">
                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 16px;">FACTURADO</div>
                            <div class="kpi-value">$924M</div>
                        </div>
                        <div class="kpi-card">
                            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 16px;">RECAUDADO</div>
                            <div class="kpi-value">$819M</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <button class="chat-toggle-btn" onclick="toggleChat()">üí¨</button>
    
    <div class="chat-widget" id="chatWidget">
        <!-- Header del chat -->
        <div class="chat-header-bar">
            <div class="chat-header-inner">
                <div class="chat-header-left">
                    <div class="chat-header-icon">ü§ñ</div>
                    <div>
                        <div class="chat-header-title">Asistente IA Universal</div>
                        <div class="chat-header-status"><span class="chat-status-dot"></span> En l√≠nea ‚Äî Hospital San Rafael</div>
                    </div>
                </div>
                <button class="chat-close-btn" onclick="toggleChat()">‚úï</button>
            </div>
        </div>
        <!-- √Årea de mensajes -->
        <div class="chat-messages-area" id="chatMessages">
            <div style="text-align: center; padding: 20px 16px 12px;">
                <div style="width: 56px; height: 56px; margin: 0 auto 10px; border-radius: 16px; background: linear-gradient(135deg, #EBF3FF, #D6E8FF); display: flex; align-items: center; justify-content: center; font-size: 28px;">ü§ñ</div>
                <h3 style="font-size: 15px; font-weight: 700; color: #1A2332;">¬°Hola! Soy tu asistente inteligente</h3>
                <p style="color: #6B7D8E; font-size: 12.5px; margin-top: 4px;">Preg√∫ntame sobre el funcionamiento del hospital</p>
            </div>
            <div class="chat-bubble bot">¬°Bienvenido, Director! Tengo acceso a todos los datos del Hospital San Rafael en tiempo real. ¬øEn qu√© puedo ayudarle?</div>
            <div class="chat-typing-indicator" id="chatTyping"><span></span><span></span><span></span></div>
        </div>
        <!-- Sugerencias r√°pidas -->
        <div class="chat-suggestions" id="chatSuggestions">
            <button class="chat-suggestion" onclick="sendSuggestion(this)">¬øC√≥mo va urgencias?</button>
            <button class="chat-suggestion" onclick="sendSuggestion(this)">Resumen ejecutivo</button>
            <button class="chat-suggestion" onclick="sendSuggestion(this)">Estado de camas</button>
            <button class="chat-suggestion" onclick="sendSuggestion(this)">Alertas activas</button>
        </div>
        <!-- Input -->
        <div class="chat-input-row">
            <input type="text" id="chatInput" placeholder="Escribe tu pregunta..." onkeydown="if(event.key==='Enter')sendMessage()">
            <button class="chat-send" id="chatSendBtn" onclick="sendMessage()">‚û§</button>
        </div>
    </div>
    
    <script>
        // === C√ìDIGO ORIGINAL - NO MODIFICADO ===
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('es-CO', {hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false});
        }
        setInterval(updateTime, 1000);
        
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                const module = item.getAttribute('data-module');
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                item.classList.add('active');
                document.querySelectorAll('.content-grid').forEach(grid => grid.classList.remove('active'));
                document.getElementById('module-' + module).classList.add('active');
                
                const titles = {
                    'ejecutivo': 'Vista Ejecutiva',
                    'calidad': 'Calidad y Anal√≠tica',
                    'urgencias': 'Urgencias',
                    'hospitalizacion': 'Hospitalizaci√≥n',
                    'consulta': 'Consulta Externa',
                    'epidemiologia': 'Epidemiolog√≠a',
                    'financiero': 'Financiero'
                };
                document.getElementById('pageTitle').textContent = titles[module];
            });
        });
        
        function toggleChat() {
            document.getElementById('chatWidget').classList.toggle('open');
            document.querySelector('.chat-toggle-btn').classList.toggle('hidden');
        }

        // === MOTOR DE INTELIGENCIA ARTIFICIAL LOCAL DEL HOSPITAL ===

        // Base de datos completa del hospital
        const hospitalData = {
            general: {
                nombre: 'Hospital San Rafael',
                nivel: 'Nivel II-III',
                ubicacion: 'Colombia',
                sistema: 'Sistema Inteligente Hospitalario',
                usuario: 'Director General',
                mesActual: 'Enero 2026'
            },
            ejecutivo: {
                pacientesHoy: 847,
                urgenciasHoy: 124,
                urgenciasEnAtencion: 18,
                ocupacion: 78,
                camasTotal: 112,
                camasOcupadas: 87,
                camasDisponibles: 25,
                satisfaccion: 4.6,
                satisfaccionMax: 5,
                encuestas: 234
            },
            uci: {
                ocupacion: 92,
                camasLibres: 3,
                camasTotal: 34,
                camasOcupadas: 31,
                alertaCritica: true,
                promedioEstancia: 6.2,
                pacientesSemana: [29, 31, 30, 32, 31, 33, 31],
                diasSemana: ['Lun','Mar','Mi√©','Jue','Vie','S√°b','Dom'],
                mortalidad: 8.4,
                ingresosSemana: 23,
                altasSemana: 19,
                diagnosticosTop: ['Insuficiencia respiratoria aguda','Sepsis','Postoperatorio cardiovascular','Trauma craneoencef√°lico','Falla multiorg√°nica'],
                ventilacionMecanica: 18
            },
            produccion: {
                consultaExterna: { cantidad: 17396, porcentaje: 74.1, estado: 'normal' },
                urgencias: { cantidad: 3720, porcentaje: 15.9, estado: 'advertencia' },
                hospitalizacion: { cantidad: 2340, porcentaje: 10.0, estado: 'normal' },
                total: 23456
            },
            calidad: {
                infeccionIntrahospitalaria: { actual: 1.2, meta: 2, cumple: true },
                reingresos30dias: { actual: 4.8, meta: 5, cumple: true },
                tiempoEsperaUrgencias: 28,
                satisfaccionEnfermeria: 4.3,
                eventosAdversos: 3,
                caidas: 1,
                mortalidadGeneral: 2.1
            },
            urgencias: {
                enAtencion: 18,
                enEspera: 7,
                totalServicio: 25,
                tiempoPromedioEspera: 28,
                triageRojo: 2,
                triageNaranja: 5,
                triageAmarillo: 8,
                triageVerde: 7,
                triageAzul: 3,
                ambulanciasHoy: 6,
                pacientesUltimas24h: 89,
                motivosTop: ['Dolor abdominal','Trauma','Disnea','Dolor tor√°cico','Cefalea severa','Fiebre alta']
            },
            hospitalizacion: {
                camasTotal: 112,
                camasOcupadas: 87,
                camasDisponibles: 25,
                ocupacionPorcentaje: 77.7,
                promedioEstancia: 4.3,
                altasHoy: 12,
                ingresosHoy: 9,
                servicios: {
                    medicinainterna: { camas: 32, ocupadas: 28, disponibles: 4 },
                    cirugia: { camas: 24, ocupadas: 19, disponibles: 5 },
                    pediatria: { camas: 18, ocupadas: 12, disponibles: 6 },
                    ginecobstetricia: { camas: 16, ocupadas: 13, disponibles: 3 },
                    uci: { camas: 34, ocupadas: 31, disponibles: 3 }
                }
            },
            consulta: {
                citasProgramadas: 247,
                citasAtendidas: 156,
                citasPendientes: 91,
                ausentismo: 8.5,
                especialidadesTop: ['Medicina General','Pediatr√≠a','Ginecolog√≠a','Cardiolog√≠a','Ortopedia','Dermatolog√≠a'],
                tiempoPromedioConsulta: 22,
                pacientesPrimerVez: 64,
                pacientesControl: 92
            },
            epidemiologia: {
                alertaActiva: true,
                alertaTipo: 'IRA (Infecci√≥n Respiratoria Aguda)',
                casos72h: 47,
                incremento: 35,
                casosSemanales: [12, 15, 18, 22, 28, 35, 47],
                semanasLabels: ['Sem -6','Sem -5','Sem -4','Sem -3','Sem -2','Sem -1','Actual'],
                otrosEventos: {
                    eda: 12,
                    dengue: 3,
                    covid: 5,
                    influenza: 8
                },
                vacunacion: 78,
                protocoloActivado: false,
                comiteProximo: 'Mi√©rcoles 10:00 AM'
            },
            financiero: {
                facturado: 924,
                recaudado: 819,
                cartera: 105,
                tasaRecaudo: 88.6,
                glosas: 47,
                glosasRecuperadas: 31,
                costoOperativo: 756,
                margenOperativo: 8.3,
                presupuestoEjecutado: 82,
                deudoresPrincipales: ['EPS Sanitas','Nueva EPS','Compensar','SOAT/ARL'],
                facturacionPorServicio: {
                    hospitalizacion: 412,
                    urgencias: 198,
                    consultaExterna: 167,
                    cirugia: 98,
                    apoyoDx: 49
                }
            },
            personal: {
                totalEmpleados: 847,
                medicos: 156,
                enfermeras: 234,
                auxiliares: 189,
                administrativos: 168,
                serviciosGenerales: 100,
                ausentismoLaboral: 3.2,
                turnoActual: 'Diurno',
                guardiaUrgencias: 'Dr. Mart√≠nez, Dra. L√≥pez',
                guardiaUCI: 'Dr. Ram√≠rez, Dra. G√≥mez',
                capacitacionesMes: 4
            },
            historico: {
                pacientesMesAnterior: 22890,
                ocupacionPromedio6meses: 75,
                tendenciaUrgencias: 'al alza (+8% vs mes anterior)',
                satisfaccionPromedio: 4.4,
                mejorMes: 'Noviembre 2025 (4.8/5 satisfacci√≥n)',
                incidentesCriticos: 0,
                cirugiasProgramadas: 186,
                cirugiasRealizadas: 178,
                cancelacionQuirurgica: 4.3
            }
        };

        // Motor de procesamiento de lenguaje natural
        function normalizar(texto) {
            return texto.toLowerCase()
                .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
                .replace(/[¬ø?¬°!.,;:()]/g, '')
                .trim();
        }

        function contienePalabras(texto, palabras) {
            const t = normalizar(texto);
            return palabras.some(p => t.includes(normalizar(p)));
        }

        function contieneAlguna(texto, grupos) {
            const t = normalizar(texto);
            return grupos.some(grupo => grupo.every(p => t.includes(normalizar(p))));
        }

        // Generador de respuestas inteligente
        function generarRespuesta(pregunta) {
            const q = normalizar(pregunta);
            const d = hospitalData;

            // --- SALUDOS ---
            if (contienePalabras(q, ['hola','buenos dias','buenas tardes','buenas noches','hey','saludos','que tal'])) {
                const hora = new Date().getHours();
                const saludo = hora < 12 ? 'Buenos d√≠as' : hora < 18 ? 'Buenas tardes' : 'Buenas noches';
                return `${saludo}, Director. üëã Estoy listo para asistirle. Actualmente tenemos <strong>${d.ejecutivo.pacientesHoy} pacientes</strong> en atenci√≥n, ocupaci√≥n al <strong>${d.ejecutivo.ocupacion}%</strong> y una alerta activa en UCI (92% ocupaci√≥n). ¬øQu√© desea consultar?`;
            }

            // --- UCI / CUIDADOS INTENSIVOS ---
            if (contienePalabras(q, ['uci','cuidados intensivos','cuidado intensivo','unidad de cuidados','critico','criticos','camas uci'])) {
                if (contienePalabras(q, ['semana','semanal','ultimos dias','ultima semana','7 dias','estos dias','historico','tendencia'])) {
                    return `üìä <strong>UCI - Reporte semanal:</strong><br><br>En la √∫ltima semana, la UCI ha manejado un promedio de <strong>31 pacientes/d√≠a</strong>, con el siguiente comportamiento:<br>‚Ä¢ Lunes: 29 | Martes: 31 | Mi√©rcoles: 30 | Jueves: 32 | Viernes: 31 | S√°bado: 33 | Domingo: 31<br>‚Ä¢ Total ingresos en la semana: <strong>${d.uci.ingresosSemana}</strong><br>‚Ä¢ Total altas en la semana: <strong>${d.uci.altasSemana}</strong><br>‚Ä¢ Pacientes en ventilaci√≥n mec√°nica: <strong>${d.uci.ventilacionMecanica}</strong><br>‚Ä¢ Promedio de estancia: <strong>${d.uci.promedioEstancia} d√≠as</strong><br><br>‚ö†Ô∏è La tendencia es al alza. Hoy estamos al <strong>92% de ocupaci√≥n</strong> con solo <strong>3 camas libres</strong>. Recomiendo evaluar altas tempranas y coordinar con hospitalizaci√≥n para liberar cupos.`;
                }
                if (contienePalabras(q, ['paciente','cuantos','cuanto','numero','cantidad'])) {
                    return `üè• <strong>UCI - Estado actual:</strong><br><br>‚Ä¢ Camas totales: <strong>${d.uci.camasTotal}</strong><br>‚Ä¢ Ocupadas: <strong>${d.uci.camasOcupadas}</strong><br>‚Ä¢ Disponibles: <strong>${d.uci.camasLibres}</strong><br>‚Ä¢ Ocupaci√≥n: <strong>${d.uci.ocupacion}%</strong> üî¥<br>‚Ä¢ Pacientes en ventilaci√≥n mec√°nica: <strong>${d.uci.ventilacionMecanica}</strong><br>‚Ä¢ Ingresos esta semana: <strong>${d.uci.ingresosSemana}</strong><br><br>Los principales diagn√≥sticos son: ${d.uci.diagnosticosTop.slice(0,3).join(', ')}. Situaci√≥n cr√≠tica, Director.`;
                }
                if (contienePalabras(q, ['mortalidad','fallecido','muerte','defuncion'])) {
                    return `La tasa de mortalidad en UCI se encuentra en <strong>${d.uci.mortalidad}%</strong>, dentro de los par√°metros esperados para nuestro nivel de complejidad. El promedio nacional para hospitales de nivel II-III est√° entre 8% y 12%. Mantenemos vigilancia activa con el comit√© de mortalidad.`;
                }
                if (contienePalabras(q, ['diagnostico','patologia','enfermedad','motivo'])) {
                    return `üìã <strong>Principales diagn√≥sticos en UCI:</strong><br><br>` + d.uci.diagnosticosTop.map((dx, i) => `${i+1}. ${dx}`).join('<br>') + `<br><br>El <strong>${Math.round(d.uci.ventilacionMecanica/d.uci.camasOcupadas*100)}%</strong> de los pacientes requieren ventilaci√≥n mec√°nica.`;
                }
                return `üî¥ <strong>ALERTA UCI - Ocupaci√≥n al ${d.uci.ocupacion}%</strong><br><br>‚Ä¢ ${d.uci.camasOcupadas} de ${d.uci.camasTotal} camas ocupadas (solo <strong>${d.uci.camasLibres} disponibles</strong>)<br>‚Ä¢ ${d.uci.ventilacionMecanica} pacientes en ventilaci√≥n mec√°nica<br>‚Ä¢ Promedio estancia: ${d.uci.promedioEstancia} d√≠as<br>‚Ä¢ Mortalidad: ${d.uci.mortalidad}%<br>‚Ä¢ Ingresos esta semana: ${d.uci.ingresosSemana} | Altas: ${d.uci.altasSemana}<br><br>Director, esta es nuestra alerta m√°s cr√≠tica. ¬øDesea que detalle los diagn√≥sticos principales o la tendencia semanal?`;
            }

            // --- URGENCIAS ---
            if (contienePalabras(q, ['urgencia','emergencia','urgente','triage','ambulancia'])) {
                if (contienePalabras(q, ['espera','esperando','demora','tiempo','cola','fila'])) {
                    return `‚è±Ô∏è <strong>Tiempos de espera en Urgencias:</strong><br><br>‚Ä¢ Tiempo promedio actual: <strong>${d.urgencias.tiempoPromedioEspera} minutos</strong><br>‚Ä¢ Pacientes en espera: <strong>${d.urgencias.enEspera}</strong><br>‚Ä¢ Pacientes en atenci√≥n: <strong>${d.urgencias.enAtencion}</strong><br><br>Distribuci√≥n por triage: üî¥ Rojo: ${d.urgencias.triageRojo} | üü† Naranja: ${d.urgencias.triageNaranja} | üü° Amarillo: ${d.urgencias.triageAmarillo} | üü¢ Verde: ${d.urgencias.triageVerde} | üîµ Azul: ${d.urgencias.triageAzul}<br><br>Los pacientes Triage I y II est√°n siendo atendidos de manera inmediata.`;
                }
                if (contienePalabras(q, ['motivo','razon','causa','diagnostico','patologia','por que vienen'])) {
                    return `üìã <strong>Principales motivos de consulta en Urgencias:</strong><br><br>` + d.urgencias.motivosTop.map((m, i) => `${i+1}. ${m}`).join('<br>') + `<br><br>Se han atendido <strong>${d.urgencias.pacientesUltimas24h} pacientes</strong> en las √∫ltimas 24 horas, con <strong>${d.urgencias.ambulanciasHoy} ambulancias</strong> recibidas hoy.`;
                }
                if (contienePalabras(q, ['cuantos','cuanto','numero','total','resumen','como va','estado'])) {
                    return `üö® <strong>Urgencias - Monitoreo en tiempo real:</strong><br><br>‚Ä¢ En atenci√≥n: <strong>${d.urgencias.enAtencion} pacientes</strong><br>‚Ä¢ En espera: <strong>${d.urgencias.enEspera} pacientes</strong><br>‚Ä¢ Total en el servicio: <strong>${d.urgencias.totalServicio}</strong><br>‚Ä¢ √öltimas 24h: <strong>${d.urgencias.pacientesUltimas24h} atenciones</strong><br>‚Ä¢ Ambulancias hoy: <strong>${d.urgencias.ambulanciasHoy}</strong><br>‚Ä¢ Tiempo promedio de espera: <strong>${d.urgencias.tiempoPromedioEspera} min</strong><br><br>‚ö†Ô∏è Las urgencias est√°n al alza (${d.produccion.urgencias.porcentaje}% de la producci√≥n total). El guardia actual: ${d.personal.guardiaUrgencias}.`;
                }
                return `üö® <strong>Estado de Urgencias:</strong><br><br>‚Ä¢ <strong>${d.urgencias.enAtencion}</strong> pacientes en atenci√≥n | <strong>${d.urgencias.enEspera}</strong> en espera<br>‚Ä¢ Triage: üî¥${d.urgencias.triageRojo} üü†${d.urgencias.triageNaranja} üü°${d.urgencias.triageAmarillo} üü¢${d.urgencias.triageVerde} üîµ${d.urgencias.triageAzul}<br>‚Ä¢ √öltimas 24h: ${d.urgencias.pacientesUltimas24h} pacientes<br>‚Ä¢ Tiempo espera promedio: ${d.urgencias.tiempoPromedioEspera} min<br>‚Ä¢ Guardia: ${d.personal.guardiaUrgencias}<br><br>Producci√≥n mensual: ${d.produccion.urgencias.cantidad.toLocaleString()} atenciones (${d.produccion.urgencias.porcentaje}% del total). ¬øNecesita m√°s detalle?`;
            }

            // --- CAMAS / OCUPACI√ìN / HOSPITALIZACI√ìN ---
            if (contienePalabras(q, ['cama','camas','ocupacion','disponible','hospitalizado','hospitalizacion','ingreso','alta','egreso'])) {
                if (contienePalabras(q, ['servicio','departamento','area','distribucion','desglose'])) {
                    const s = d.hospitalizacion.servicios;
                    return `üè• <strong>Distribuci√≥n de camas por servicio:</strong><br><br>‚Ä¢ Medicina Interna: ${s.medicinainterna.ocupadas}/${s.medicinainterna.camas} (${Math.round(s.medicinainterna.ocupadas/s.medicinainterna.camas*100)}%) - ${s.medicinainterna.disponibles} libres<br>‚Ä¢ Cirug√≠a: ${s.cirugia.ocupadas}/${s.cirugia.camas} (${Math.round(s.cirugia.ocupadas/s.cirugia.camas*100)}%) - ${s.cirugia.disponibles} libres<br>‚Ä¢ Pediatr√≠a: ${s.pediatria.ocupadas}/${s.pediatria.camas} (${Math.round(s.pediatria.ocupadas/s.pediatria.camas*100)}%) - ${s.pediatria.disponibles} libres<br>‚Ä¢ Ginecobstetricia: ${s.ginecobstetricia.ocupadas}/${s.ginecobstetricia.camas} (${Math.round(s.ginecobstetricia.ocupadas/s.ginecobstetricia.camas*100)}%) - ${s.ginecobstetricia.disponibles} libres<br>‚Ä¢ UCI: ${s.uci.ocupadas}/${s.uci.camas} (<strong>${Math.round(s.uci.ocupadas/s.uci.camas*100)}%</strong>) - ${s.uci.disponibles} libres üî¥<br><br>Total: <strong>${d.hospitalizacion.camasOcupadas}/${d.hospitalizacion.camasTotal}</strong> (${d.hospitalizacion.ocupacionPorcentaje}%)`;
                }
                return `üè• <strong>Estado de Hospitalizaci√≥n:</strong><br><br>‚Ä¢ Camas totales: <strong>${d.hospitalizacion.camasTotal}</strong><br>‚Ä¢ Ocupadas: <strong>${d.hospitalizacion.camasOcupadas}</strong> (${d.hospitalizacion.ocupacionPorcentaje}%)<br>‚Ä¢ Disponibles: <strong>${d.hospitalizacion.camasDisponibles}</strong><br>‚Ä¢ Ingresos hoy: <strong>${d.hospitalizacion.ingresosHoy}</strong> | Altas hoy: <strong>${d.hospitalizacion.altasHoy}</strong><br>‚Ä¢ Promedio estancia: <strong>${d.hospitalizacion.promedioEstancia} d√≠as</strong><br><br>‚ö†Ô∏è UCI es el servicio m√°s cr√≠tico con solo ${d.uci.camasLibres} camas libres. ¬øDesea ver el desglose por servicio?`;
            }

            // --- CONSULTA EXTERNA ---
            if (contienePalabras(q, ['consulta externa','citas','cita','programadas','atendidas','ausentismo','especialidad','agenda'])) {
                if (contienePalabras(q, ['ausentismo','falta','no asistieron','inasistencia'])) {
                    return `üìÖ El ausentismo en Consulta Externa est√° en <strong>${d.consulta.ausentismo}%</strong>, lo cual es aceptable (el est√°ndar es <10%). De las ${d.consulta.citasProgramadas} citas programadas hoy, aproximadamente <strong>${Math.round(d.consulta.citasProgramadas * d.consulta.ausentismo / 100)} pacientes</strong> no asistieron. Recomiendo reforzar los recordatorios por SMS 24h antes.`;
                }
                return `üìÖ <strong>Consulta Externa - Hoy:</strong><br><br>‚Ä¢ Citas programadas: <strong>${d.consulta.citasProgramadas}</strong><br>‚Ä¢ Atendidas: <strong>${d.consulta.citasAtendidas}</strong><br>‚Ä¢ Pendientes: <strong>${d.consulta.citasPendientes}</strong><br>‚Ä¢ Ausentismo: <strong>${d.consulta.ausentismo}%</strong><br>‚Ä¢ Primera vez: ${d.consulta.pacientesPrimerVez} | Control: ${d.consulta.pacientesControl}<br>‚Ä¢ Tiempo promedio por consulta: ${d.consulta.tiempoPromedioConsulta} min<br><br>Especialidades m√°s demandadas: ${d.consulta.especialidadesTop.slice(0,4).join(', ')}.<br>Producci√≥n mensual: <strong>${d.produccion.consultaExterna.cantidad.toLocaleString()}</strong> atenciones (${d.produccion.consultaExterna.porcentaje}% del total).`;
            }

            // --- EPIDEMIOLOG√çA ---
            if (contienePalabras(q, ['epidemiologia','ira','respiratoria','brote','contagio','infeccion','dengue','covid','influenza','virus','alerta epidemiologica','casos','epidemiol'])) {
                if (contienePalabras(q, ['tendencia','semana','evolucion','comportamiento','grafico','curva'])) {
                    return `üìà <strong>Tendencia epidemiol√≥gica IRA (√∫ltimas 7 semanas):</strong><br><br>` + d.epidemiologia.casosSemanales.map((c, i) => `${d.epidemiologia.semanasLabels[i]}: ${c} casos ${i === 6 ? '‚ö†Ô∏è (actual)' : ''}`).join('<br>') + `<br><br>La curva muestra un ascenso sostenido del <strong>${d.epidemiologia.incremento}%</strong> respecto al promedio. Se recomienda activar protocolo de contingencia si la tendencia contin√∫a.`;
                }
                if (contienePalabras(q, ['otro','otros','dengue','covid','eda','demas'])) {
                    const o = d.epidemiologia.otrosEventos;
                    return `ü¶† <strong>Otros eventos epidemiol√≥gicos activos:</strong><br><br>‚Ä¢ EDA (Enfermedad Diarreica Aguda): <strong>${o.eda} casos</strong><br>‚Ä¢ Influenza: <strong>${o.influenza} casos</strong><br>‚Ä¢ COVID-19: <strong>${o.covid} casos</strong><br>‚Ä¢ Dengue: <strong>${o.dengue} casos</strong><br>‚Ä¢ Cobertura de vacunaci√≥n: <strong>${d.epidemiologia.vacunacion}%</strong><br><br>Pr√≥ximo comit√© de vigilancia epidemiol√≥gica: <strong>${d.epidemiologia.comiteProximo}</strong>.`;
                }
                return `üî¥ <strong>ALERTA EPIDEMIOL√ìGICA ACTIVA</strong><br><br>‚Ä¢ Evento: <strong>${d.epidemiologia.alertaTipo}</strong><br>‚Ä¢ Casos en 72h: <strong>${d.epidemiologia.casos72h}</strong><br>‚Ä¢ Incremento: <strong>‚Üë${d.epidemiologia.incremento}%</strong> vs promedio hist√≥rico<br>‚Ä¢ Protocolo de contingencia: ${d.epidemiologia.protocoloActivado ? 'Activado ‚úì' : 'Pendiente de activaci√≥n'}<br>‚Ä¢ Pr√≥ximo comit√©: ${d.epidemiologia.comiteProximo}<br><br>Otros eventos: EDA (${d.epidemiologia.otrosEventos.eda}), Influenza (${d.epidemiologia.otrosEventos.influenza}), COVID (${d.epidemiologia.otrosEventos.covid}), Dengue (${d.epidemiologia.otrosEventos.dengue}).<br><br>Director, dado el incremento del 35%, recomendar√≠a considerar la activaci√≥n del protocolo de contingencia respiratoria.`;
            }

            // --- FINANCIERO ---
            if (contienePalabras(q, ['financiero','dinero','plata','facturado','recaudado','cartera','glosa','presupuesto','costo','gasto','ingreso financiero','rentabilidad','margen','facturacion'])) {
                if (contienePalabras(q, ['glosa','rechazo','devolucion','objecion'])) {
                    return `üí∞ <strong>Estado de Glosas:</strong><br><br>‚Ä¢ Glosas recibidas: <strong>$${d.financiero.glosas}M</strong><br>‚Ä¢ Glosas recuperadas: <strong>$${d.financiero.glosasRecuperadas}M</strong> (${Math.round(d.financiero.glosasRecuperadas/d.financiero.glosas*100)}%)<br>‚Ä¢ Pendientes por gestionar: <strong>$${d.financiero.glosas - d.financiero.glosasRecuperadas}M</strong><br><br>La tasa de recuperaci√≥n es buena, pero recomendar√≠a revisar los procesos de facturaci√≥n para reducir las glosas desde el origen.`;
                }
                if (contienePalabras(q, ['servicio','desglose','detalle','area'])) {
                    const f = d.financiero.facturacionPorServicio;
                    return `üí∞ <strong>Facturaci√≥n por servicio (Enero 2026):</strong><br><br>‚Ä¢ Hospitalizaci√≥n: <strong>$${f.hospitalizacion}M</strong> (${Math.round(f.hospitalizacion/d.financiero.facturado*100)}%)<br>‚Ä¢ Urgencias: <strong>$${f.urgencias}M</strong> (${Math.round(f.urgencias/d.financiero.facturado*100)}%)<br>‚Ä¢ Consulta Externa: <strong>$${f.consultaExterna}M</strong> (${Math.round(f.consultaExterna/d.financiero.facturado*100)}%)<br>‚Ä¢ Cirug√≠a: <strong>$${f.cirugia}M</strong> (${Math.round(f.cirugia/d.financiero.facturado*100)}%)<br>‚Ä¢ Apoyo Diagn√≥stico: <strong>$${f.apoyoDx}M</strong> (${Math.round(f.apoyoDx/d.financiero.facturado*100)}%)<br><br>Total facturado: <strong>$${d.financiero.facturado}M</strong>`;
                }
                if (contienePalabras(q, ['cartera','deudor','deben','cobrar','pendiente'])) {
                    return `üí∞ <strong>Estado de Cartera:</strong><br><br>‚Ä¢ Cartera total pendiente: <strong>$${d.financiero.cartera}M</strong><br>‚Ä¢ Tasa de recaudo: <strong>${d.financiero.tasaRecaudo}%</strong><br><br>Principales deudores:<br>` + d.financiero.deudoresPrincipales.map((de, i) => `${i+1}. ${de}`).join('<br>') + `<br><br>Recomiendo intensificar gesti√≥n de cobro con las EPS que tienen mayor mora.`;
                }
                return `üí∞ <strong>Resumen Financiero - Enero 2026:</strong><br><br>‚Ä¢ Facturado: <strong>$${d.financiero.facturado}M</strong><br>‚Ä¢ Recaudado: <strong>$${d.financiero.recaudado}M</strong><br>‚Ä¢ Cartera pendiente: <strong>$${d.financiero.cartera}M</strong><br>‚Ä¢ Tasa de recaudo: <strong>${d.financiero.tasaRecaudo}%</strong><br>‚Ä¢ Costo operativo: <strong>$${d.financiero.costoOperativo}M</strong><br>‚Ä¢ Margen operativo: <strong>${d.financiero.margenOperativo}%</strong><br>‚Ä¢ Presupuesto ejecutado: <strong>${d.financiero.presupuestoEjecutado}%</strong><br>‚Ä¢ Glosas: $${d.financiero.glosas}M (recuperadas: $${d.financiero.glosasRecuperadas}M)`;
            }

            // --- CALIDAD ---
            if (contienePalabras(q, ['calidad','indicador','meta','infeccion intrahospitalaria','reingreso','evento adverso','caida'])) {
                return `üèÜ <strong>Indicadores de Calidad:</strong><br><br>‚Ä¢ Infecci√≥n intrahospitalaria: <strong>${d.calidad.infeccionIntrahospitalaria.actual}%</strong> (Meta: <${d.calidad.infeccionIntrahospitalaria.meta}%) ‚úÖ<br>‚Ä¢ Reingresos 30 d√≠as: <strong>${d.calidad.reingresos30dias.actual}%</strong> (Meta: <${d.calidad.reingresos30dias.meta}%) ‚úÖ<br>‚Ä¢ Tiempo espera urgencias: <strong>${d.calidad.tiempoEsperaUrgencias} min</strong><br>‚Ä¢ Satisfacci√≥n enfermer√≠a: <strong>${d.calidad.satisfaccionEnfermeria}/5</strong><br>‚Ä¢ Eventos adversos del mes: <strong>${d.calidad.eventosAdversos}</strong><br>‚Ä¢ Ca√≠das reportadas: <strong>${d.calidad.caidas}</strong><br>‚Ä¢ Mortalidad general: <strong>${d.calidad.mortalidadGeneral}%</strong><br><br>Todos los indicadores principales est√°n dentro de meta. ¬°Buen trabajo del equipo!`;
            }

            // --- PERSONAL / RECURSO HUMANO ---
            if (contienePalabras(q, ['personal','empleado','medico','enfermera','doctor','recurso humano','nomina','guardia','turno','staff','trabajador','quien esta'])) {
                if (contienePalabras(q, ['guardia','turno','quien esta','disponible'])) {
                    return `üë®‚Äç‚öïÔ∏è <strong>Guardias actuales (Turno ${d.personal.turnoActual}):</strong><br><br>‚Ä¢ Urgencias: <strong>${d.personal.guardiaUrgencias}</strong><br>‚Ä¢ UCI: <strong>${d.personal.guardiaUCI}</strong><br><br>Turno actual: <strong>${d.personal.turnoActual}</strong><br>Total personal activo: ${d.personal.totalEmpleados}<br>Ausentismo laboral: ${d.personal.ausentismoLaboral}%`;
                }
                return `üë• <strong>Recurso Humano:</strong><br><br>‚Ä¢ Total empleados: <strong>${d.personal.totalEmpleados}</strong><br>‚Ä¢ M√©dicos: ${d.personal.medicos} | Enfermeras: ${d.personal.enfermeras}<br>‚Ä¢ Auxiliares: ${d.personal.auxiliares} | Administrativos: ${d.personal.administrativos}<br>‚Ä¢ Servicios generales: ${d.personal.serviciosGenerales}<br>‚Ä¢ Ausentismo laboral: <strong>${d.personal.ausentismoLaboral}%</strong><br>‚Ä¢ Capacitaciones este mes: ${d.personal.capacitacionesMes}<br>‚Ä¢ Turno actual: ${d.personal.turnoActual}`;
            }

            // --- RESUMEN EJECUTIVO ---
            if (contienePalabras(q, ['resumen','ejecutivo','general','como estamos','como esta el hospital','panorama','vision general','estado general','todo','completo','dashboard'])) {
                return `üìä <strong>Resumen Ejecutivo - Hospital San Rafael</strong><br><br>üè• <strong>Operaciones:</strong> ${d.ejecutivo.pacientesHoy} pacientes hoy | Ocupaci√≥n ${d.ejecutivo.ocupacion}% (${d.ejecutivo.camasOcupadas}/${d.ejecutivo.camasTotal})<br>üö® <strong>Urgencias:</strong> ${d.urgencias.totalServicio} pacientes (${d.urgencias.enAtencion} en atenci√≥n, ${d.urgencias.enEspera} en espera)<br>üî¥ <strong>UCI:</strong> ${d.uci.ocupacion}% ocupaci√≥n - ALERTA (solo ${d.uci.camasLibres} camas)<br>üìÖ <strong>Consulta:</strong> ${d.consulta.citasAtendidas}/${d.consulta.citasProgramadas} citas | Ausentismo ${d.consulta.ausentismo}%<br>ü¶† <strong>Epidemiolog√≠a:</strong> Alerta IRA - ${d.epidemiologia.casos72h} casos/72h (‚Üë${d.epidemiologia.incremento}%)<br>üí∞ <strong>Financiero:</strong> Facturado $${d.financiero.facturado}M | Recaudado $${d.financiero.recaudado}M (${d.financiero.tasaRecaudo}%)<br>‚≠ê <strong>Satisfacci√≥n:</strong> ${d.ejecutivo.satisfaccion}/${d.ejecutivo.satisfaccionMax}<br>‚úÖ <strong>Calidad:</strong> Todos los indicadores en meta<br><br><strong>Prioridades inmediatas:</strong> 1) Gestionar ocupaci√≥n UCI 2) Monitorear brote IRA 3) Mejorar recaudo de cartera.`;
            }

            // --- ALERTAS ---
            if (contienePalabras(q, ['alerta','alarma','critico','critica','prioridad','problema','riesgo','atencion inmediata','pendiente'])) {
                return `üö® <strong>Alertas activas en este momento:</strong><br><br>üî¥ <strong>CR√çTICA - UCI al ${d.uci.ocupacion}%:</strong> Solo ${d.uci.camasLibres} camas disponibles. Requiere gesti√≥n inmediata de altas y posible derivaci√≥n a otras instituciones.<br><br>üî¥ <strong>ALERTA EPIDEMIOL√ìGICA - IRA:</strong> ${d.epidemiologia.casos72h} casos en 72h, incremento del ${d.epidemiologia.incremento}%. Se recomienda activar protocolo de contingencia.<br><br>üü° <strong>ADVERTENCIA - Urgencias:</strong> Producci√≥n al alza (${d.produccion.urgencias.porcentaje}% del total). ${d.urgencias.enEspera} pacientes en espera.<br><br>üü° <strong>CARTERA:</strong> $${d.financiero.cartera}M pendientes de recaudo. Tasa actual: ${d.financiero.tasaRecaudo}%.<br><br>¬øDesea que profundice en alguna de estas alertas?`;
            }

            // --- SATISFACCI√ìN ---
            if (contienePalabras(q, ['satisfaccion','encuesta','opinion','paciente opina','calificacion','valoracion','experiencia del paciente'])) {
                return `‚≠ê <strong>Satisfacci√≥n del Paciente:</strong><br><br>‚Ä¢ Calificaci√≥n general: <strong>${d.ejecutivo.satisfaccion}/${d.ejecutivo.satisfaccionMax}</strong><br>‚Ä¢ Encuestas realizadas: <strong>${d.ejecutivo.encuestas}</strong><br>‚Ä¢ Satisfacci√≥n con enfermer√≠a: <strong>${d.calidad.satisfaccionEnfermeria}/5</strong><br>‚Ä¢ Promedio √∫ltimos 6 meses: <strong>${d.historico.satisfaccionPromedio}/5</strong><br>‚Ä¢ Mejor mes: ${d.historico.mejorMes}<br><br>Estamos por encima del promedio hist√≥rico (${d.historico.satisfaccionPromedio}). Los pacientes destacan la atenci√≥n de enfermer√≠a y el trato humanizado.`;
            }

            // --- PRODUCCI√ìN ---
            if (contienePalabras(q, ['produccion','atenciones','cuantos pacientes mes','mensual','estadistica','enero'])) {
                return `üìà <strong>Producci√≥n Mensual - ${d.general.mesActual}:</strong><br><br>‚Ä¢ Consulta Externa: <strong>${d.produccion.consultaExterna.cantidad.toLocaleString()}</strong> (${d.produccion.consultaExterna.porcentaje}%) ‚úÖ<br>‚Ä¢ Urgencias: <strong>${d.produccion.urgencias.cantidad.toLocaleString()}</strong> (${d.produccion.urgencias.porcentaje}%) ‚ö†Ô∏è<br>‚Ä¢ Hospitalizaci√≥n: <strong>${d.produccion.hospitalizacion.cantidad.toLocaleString()}</strong> (${d.produccion.hospitalizacion.porcentaje}%) ‚úÖ<br>‚Ä¢ <strong>Total: ${d.produccion.total.toLocaleString()} atenciones</strong><br><br>Mes anterior: ${d.historico.pacientesMesAnterior.toLocaleString()}. Tendencia de urgencias: ${d.historico.tendenciaUrgencias}.`;
            }

            // --- CIRUG√çAS ---
            if (contienePalabras(q, ['cirugia','quirofano','operacion','quirurgica','cirujano','programacion quirurgica'])) {
                return `üî™ <strong>Actividad Quir√∫rgica:</strong><br><br>‚Ä¢ Cirug√≠as programadas: <strong>${d.historico.cirugiasProgramadas}</strong><br>‚Ä¢ Cirug√≠as realizadas: <strong>${d.historico.cirugiasRealizadas}</strong><br>‚Ä¢ Tasa de cancelaci√≥n: <strong>${d.historico.cancelacionQuirurgica}%</strong><br>‚Ä¢ Camas de cirug√≠a: ${d.hospitalizacion.servicios.cirugia.ocupadas}/${d.hospitalizacion.servicios.cirugia.camas} ocupadas<br>‚Ä¢ Facturaci√≥n por cirug√≠a: <strong>$${d.financiero.facturacionPorServicio.cirugia}M</strong><br><br>La tasa de cancelaci√≥n est√° dentro de lo aceptable (<5%).`;
            }

            // --- PEDIATR√çA ---
            if (contienePalabras(q, ['pediatria','ni√±os','ninos','infantil','neonato','recien nacido'])) {
                const ped = d.hospitalizacion.servicios.pediatria;
                return `üë∂ <strong>Servicio de Pediatr√≠a:</strong><br><br>‚Ä¢ Camas: ${ped.ocupadas}/${ped.camas} ocupadas (${Math.round(ped.ocupadas/ped.camas*100)}%)<br>‚Ä¢ Disponibles: <strong>${ped.disponibles} camas</strong><br><br>El servicio mantiene buena disponibilidad. Dada la alerta IRA, se recomienda monitoreo especial de pacientes pedi√°tricos con s√≠ntomas respiratorios.`;
            }

            // --- GINECOLOG√çA ---
            if (contienePalabras(q, ['ginecologia','obstetricia','parto','embarazo','materno','maternidad','cesarea'])) {
                const gin = d.hospitalizacion.servicios.ginecobstetricia;
                return `ü§∞ <strong>Ginecobstetricia:</strong><br><br>‚Ä¢ Camas: ${gin.ocupadas}/${gin.camas} ocupadas (${Math.round(gin.ocupadas/gin.camas*100)}%)<br>‚Ä¢ Disponibles: <strong>${gin.disponibles} camas</strong><br><br>El servicio opera con normalidad. Disponibilidad adecuada para posibles ingresos de urgencia obst√©trica.`;
            }

            // --- MEDICINA INTERNA ---
            if (contienePalabras(q, ['medicina interna','internista'])) {
                const mi = d.hospitalizacion.servicios.medicinainterna;
                return `ü©∫ <strong>Medicina Interna:</strong><br><br>‚Ä¢ Camas: ${mi.ocupadas}/${mi.camas} ocupadas (${Math.round(mi.ocupadas/mi.camas*100)}%)<br>‚Ä¢ Disponibles: <strong>${mi.disponibles} camas</strong><br><br>Es el servicio con mayor ocupaci√≥n despu√©s de UCI. Se recomienda agilizar altas pendientes para mantener disponibilidad.`;
            }

            // --- PACIENTES HOY ---
            if (contienePalabras(q, ['pacientes hoy','cuantos pacientes','atencion hoy','hoy cuantos'])) {
                return `üìä Hoy se han registrado <strong>${d.ejecutivo.pacientesHoy} pacientes</strong> en total.<br><br>Distribuci√≥n: Urgencias (${d.ejecutivo.urgenciasHoy}), Consulta Externa (${d.consulta.citasAtendidas} atendidas de ${d.consulta.citasProgramadas}), Hospitalizaci√≥n (${d.hospitalizacion.camasOcupadas} hospitalizados activos).<br><br>Comparado con el promedio diario del mes anterior (${Math.round(d.historico.pacientesMesAnterior/30)} pac/d√≠a), estamos en un rango normal.`;
            }

            // --- RECOMENDACIONES ---
            if (contienePalabras(q, ['recomendacion','sugerencia','que hago','que deberia','accion','plan','mejorar','optimizar','estrategia'])) {
                return `üìã <strong>Recomendaciones prioritarias:</strong><br><br><strong>1. UCI (Urgente):</strong> Con 92% de ocupaci√≥n, se recomienda revisar pacientes con posibilidad de paso a piso, contactar red hospitalaria para posibles traslados, y suspender cirug√≠as electivas que requieran UCI postoperatoria.<br><br><strong>2. Brote IRA:</strong> Activar protocolo de contingencia respiratoria, reforzar medidas de aislamiento, aumentar stock de insumos respiratorios y programar comit√© extraordinario.<br><br><strong>3. Cartera ($${d.financiero.cartera}M):</strong> Gesti√≥n intensiva con EPS morosas. Priorizar conciliaci√≥n con ${d.financiero.deudoresPrincipales[0]} y ${d.financiero.deudoresPrincipales[1]}.<br><br><strong>4. Urgencias:</strong> Dado el incremento, considerar personal adicional en turnos pico y agilizar flujo de pacientes hacia hospitalizaci√≥n.`;
            }

            // --- GRACIAS / DESPEDIDA ---
            if (contienePalabras(q, ['gracias','agradezco','perfecto','excelente','genial','ok','vale','listo'])) {
                return `¬°Con gusto, Director! üòä Estoy aqu√≠ para lo que necesite. Recuerde que puede preguntarme sobre cualquier √°rea del hospital: urgencias, UCI, camas, finanzas, epidemiolog√≠a, calidad, personal, cirug√≠as, y mucho m√°s.`;
            }

            // --- AYUDA ---
            if (contienePalabras(q, ['ayuda','que puedes','que sabes','como funciona','opciones','menu','que puedo preguntar'])) {
                return `ü§ñ <strong>¬°Puedo ayudarle con todo esto!</strong><br><br>üìä <strong>Operativo:</strong> Estado de urgencias, camas, UCI, hospitalizaci√≥n, consulta externa<br>üìà <strong>Producci√≥n:</strong> Atenciones diarias, mensuales, por servicio<br>üèÜ <strong>Calidad:</strong> Indicadores, infecciones, reingresos, satisfacci√≥n<br>ü¶† <strong>Epidemiolog√≠a:</strong> Alertas, brotes, tendencias, vacunaci√≥n<br>üí∞ <strong>Financiero:</strong> Facturaci√≥n, recaudo, cartera, glosas, costos<br>üë• <strong>Personal:</strong> Empleados, guardias, turnos, ausentismo<br>üî™ <strong>Cirug√≠a:</strong> Programaci√≥n, cancelaciones, quir√≥fanos<br>üö® <strong>Alertas:</strong> Estado cr√≠tico, prioridades, recomendaciones<br><br>Pruebe preguntas como: <em>"¬øCu√°ntos pacientes hay en UCI esta semana?"</em>, <em>"¬øC√≥mo va la cartera?"</em>, <em>"Dame las alertas activas"</em>`;
            }

            // --- CATCH-ALL INTELIGENTE ---
            // Si no matchea nada espec√≠fico, intenta dar una respuesta √∫til
            if (contienePalabras(q, ['cuanto','cuantos','cuantas','numero','total'])) {
                return `üìä Le comparto los n√∫meros principales del hospital:<br><br>‚Ä¢ Pacientes hoy: <strong>${d.ejecutivo.pacientesHoy}</strong><br>‚Ä¢ Ocupaci√≥n: <strong>${d.ejecutivo.ocupacion}%</strong> (${d.ejecutivo.camasOcupadas}/${d.ejecutivo.camasTotal} camas)<br>‚Ä¢ Urgencias: <strong>${d.urgencias.totalServicio}</strong> en el servicio<br>‚Ä¢ UCI: <strong>${d.uci.camasOcupadas}/${d.uci.camasTotal}</strong> (${d.uci.ocupacion}%)<br>‚Ä¢ Consultas hoy: <strong>${d.consulta.citasAtendidas}/${d.consulta.citasProgramadas}</strong><br>‚Ä¢ Facturado: <strong>$${d.financiero.facturado}M</strong><br><br>¬øSobre qu√© √°rea espec√≠fica le gustar√≠a m√°s detalle?`;
            }

            if (contienePalabras(q, ['como','estado','va','situacion','anda'])) {
                return `üìä El hospital opera con normalidad general. Puntos clave:<br><br>‚Ä¢ Ocupaci√≥n: <strong>${d.ejecutivo.ocupacion}%</strong> - Dentro de rango<br>‚Ä¢ UCI al <strong>${d.uci.ocupacion}%</strong> üî¥ - Requiere atenci√≥n<br>‚Ä¢ Urgencias: ${d.urgencias.totalServicio} pacientes (${d.urgencias.enEspera} en espera)<br>‚Ä¢ Calidad: Todos los indicadores en meta ‚úÖ<br>‚Ä¢ Satisfacci√≥n: ${d.ejecutivo.satisfaccion}/5 ‚≠ê<br><br>Las dos alertas activas son: UCI (ocupaci√≥n cr√≠tica) y brote IRA (${d.epidemiologia.casos72h} casos en 72h). ¬øDesea profundizar en alguna?`;
            }

            // --- RESPUESTA POR DEFECTO ---
            return `Entiendo su consulta. Con base en los datos del Hospital San Rafael, le puedo informar que hoy manejamos <strong>${d.ejecutivo.pacientesHoy} pacientes</strong>, con ocupaci√≥n al <strong>${d.ejecutivo.ocupacion}%</strong>. Tenemos alertas activas en UCI (${d.uci.ocupacion}%) y epidemiolog√≠a (IRA: ${d.epidemiologia.casos72h} casos).<br><br>¬øPodr√≠a ser m√°s espec√≠fico? Puedo darle informaci√≥n sobre: <strong>urgencias, UCI, camas, consulta externa, epidemiolog√≠a, finanzas, calidad, personal, cirug√≠as</strong> o un <strong>resumen ejecutivo</strong> completo.`; 
        }

        // === Funciones de UI del chat (sin cambios) ===

        function addMessage(text, type) {
            const messagesArea = document.getElementById('chatMessages');
            const typing = document.getElementById('chatTyping');
            const bubble = document.createElement('div');
            bubble.className = 'chat-bubble ' + type;
            bubble.innerHTML = text;
            messagesArea.insertBefore(bubble, typing);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        function showTyping(show) {
            const el = document.getElementById('chatTyping');
            if (show) { el.classList.add('visible'); } else { el.classList.remove('visible'); }
            document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
        }

        function sendSuggestion(btn) {
            document.getElementById('chatSuggestions').style.display = 'none';
            document.getElementById('chatInput').value = btn.textContent;
            sendMessage();
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const text = input.value.trim();
            if (!text) return;

            addMessage(text, 'user');
            input.value = '';
            showTyping(true);

            // Simular tiempo de "pensamiento" para que se sienta real
            const delay = 400 + Math.random() * 800;
            setTimeout(() => {
                showTyping(false);
                const respuesta = generarRespuesta(text);
                addMessage(respuesta, 'bot');
            }, delay);

            input.focus();
        }
    </script>
</body>
</html>
